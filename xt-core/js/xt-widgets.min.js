(function(a){a.widget("ui.xtTaobaoItemCats",{options:{f_a:"",f_cid:"",f_cname:"",is_parent:false,limit:1,cids:"",cnames:"",type:""},_create:function(){},_init:function(){var g=this,j=g.options.cids.split(","),k=g.options.cnames.split(",");if(g.options.type==""){alert("\u672a\u6307\u5b9a\u54ea\u4e2a\u5e73\u53f0\u7684\u5206\u7c7b");return false}if(j.length>0&&k.length>0&&j.length==k.length)for(var e=0;e<j.length;e++){var b=k[e],c=j[e];if(c>0){b=a('<li cid="'+c+'" cname="'+b+'"><span>'+b+"</span></li>");
a("#X_Cat_Selector_Selected").append(b);g.initCategorySelectedLi(b)}}a("#X_Cat_Selector a.btn_left").click(function(){if(a(this).hasClass("btn_leftActive")){var d=a("#X_Cat_Selector .xt-pre"),f=d.scrollLeft()-236;if(f==0){d.scrollLeft(0);g.resizeLeftRightBtn()}else d.animate({scrollLeft:"-="+f},function(){g.resizeLeftRightBtn()})}});a("#X_Cat_Selector a.btn_right").click(function(){if(a(this).hasClass("btn_rightActive")){var d=a("#X_Cat_Selector .xt-pre"),f=d.scrollLeft()+236;d.animate({scrollLeft:"+="+
f},function(){g.resizeLeftRightBtn()})}});a("#X_Cat_Selector .btn_del").click(function(){var d=a("#X_Cat_Selector_Selected li.active");if(d.length==0){alert("\u60a8\u5c1a\u672a\u9009\u62e9\u8981\u5220\u9664\u7684\u5206\u7c7b");return false}d.remove();return false});a("#X_Cat_Selector .btn_up").click(function(){var d=a("#X_Cat_Selector_Selected li.active");if(d.length==0){alert("\u60a8\u5c1a\u672a\u9009\u62e9\u8981\u4e0a\u79fb\u7684\u5206\u7c7b");return false}var f=d.prev();f.length==1&&f.before(d);
return false});a("#X_Cat_Selector .btn_down").click(function(){var d=a("#X_Cat_Selector_Selected li.active");if(d.length==0){alert("\u60a8\u5c1a\u672a\u9009\u62e9\u8981\u4e0b\u79fb\u7684\u5206\u7c7b");return false}var f=d.next();f.length==1&&f.after(d);return false});a("#X_Cat_Selector_Cats li").each(function(){g.initCategoryLi(a(this))});a("#X_Cat_Selector_Save").click(function(){var d=g.options.f_a,f=g.options.f_cid,i=g.options.f_cname;if(d==""||f==""||i==""){alert("\u672a\u6307\u5b9a\u8981\u5b58\u50a8\u7684\u4f4d\u7f6e");
return false}var h=[],l=[];a("#X_Cat_Selector_Selected li").each(function(){h.push(a(this).attr("cid"));l.push(a(this).attr("cname"))});h=h.join(",");l=l.join(",");a("#"+f).val(h);a("#"+i).val(l);a("#"+d).attr("data-cids",h);a("#"+d).attr("data-cnames",l);tb_remove()})},initCategorySelectedLi:function(g){g.hover(function(){a(this).addClass("overactive").siblings().removeClass("overactive")},function(){a(this).removeClass("overactive")}).click(function(){a(this).addClass("active").siblings().removeClass("active")})},
resizeLeftRightBtn:function(){var g=a("#X_Cat_Selector .xt-pre"),j=a("ul",g),k=a("#X_Cat_Selector .btn_left"),e=a("#X_Cat_Selector .btn_right");if(j.size()>2)if(g.scrollLeft()==0){e.addClass("btn_rightActive");k.removeClass("btn_leftActive")}else{g.scrollLeft()+472<j.size()*236?e.addClass("btn_rightActive"):e.removeClass("btn_rightActive");k.addClass("btn_leftActive")}else{e.removeClass("btn_rightActive");k.removeClass("btn_leftActive")}},initCategoryLi:function(g){var j=this,k=j.options.limit,e=
j.options.is_parent;a(".btn_add",g).click(function(b){var c=a("#X_Cat_Selector_Selected");k==1&&c.find("li").remove();if(c.find("li").length>=k){alert("\u5206\u7c7b\u6700\u591a\u53ef\u4ee5\u9009\u62e9"+k+"\u4e2a");b.stopPropagation();return false}var d=a(this).attr("cid"),f=a(this).attr("cname");if(c.find('li[cid="'+d+'"]').length==1){alert("\u5f53\u524d\u5206\u7c7b\u3010"+f+"\u3011\u5df2\u7ecf\u6dfb\u52a0");b.stopPropagation();return false}d=a('<li cid="'+d+'" cname="'+f+'"><span>'+f+"</span></li>");
c.append(d);j.initCategorySelectedLi(d);b.stopPropagation()});g.hover(function(){a(this).addClass("overactive").siblings().removeClass("overactive")},function(){a(this).removeClass("overactive")}).click(function(){if("1"==a(this).attr("is_parent")){a(this).addClass("active").siblings().removeClass("active");a(this).parent().nextAll("ul").remove();a.getJSON(ajaxurl,{action:"xt_admin_ajax_itemcats",type:j.options.type,cid:a(this).attr("cid")},function(b){if(b&&b.length>0){for(var c=a('<ul style="position:relative;left:0;top:0;"></ul>'),
d=0;d<b.length;d++){var f=b[d];f=a('<li cid="'+f.cid+'" is_parent="'+f.is_parent+'">'+(f.is_parent==1?'<b class="arrow-right"></b>':"")+"<span>"+f.name+"</span>"+(e?f.is_parent?'<a href="javascript:void(0);" class="btn_add" cid="'+f.cid+'" cname="'+f.name+'">\u6dfb\u52a0</a>':"":'<a href="javascript:void(0);" class="btn_add" cid="'+f.cid+'" cname="'+f.name+'">\u6dfb\u52a0</a>')+"</li>");c.append(f);j.initCategoryLi(f)}g.parent().after(c);b=a("#X_Cat_Selector .xt-pre");c=a("ul",b).length;d=0;if(c>
2)if(b.scrollLeft()+472<c*236)d=b.scrollLeft()+236;else if(b.scrollLeft()+472>c*236)d=b.scrollLeft()-236;b.animate({scrollLeft:"+="+d},function(){j.resizeLeftRightBtn()})}})}})}})})(jQuery);var wpWidgets,ADD_PARENT=null,CHANGE_LAYOUT=null,EDITOR=null,TEXTAREA=null;
(function(a){function g(e,b,c,d){a.ajax({type:"post",dataType:"html",url:ajaxurl,data:{action:"xt_ajax_api_page",sid:SID,id:e,name:b},success:function(f){typeof c=="function"&&c(f)},error:function(f,i,h){typeof d=="function"&&d(f,i,h)}})}function j(e){a("#X_Bd .span3 select.X-Grid-Size,#X_Bd .span9 select.X-Grid-Size").each(function(){a(this).find('option[value="small"]').remove();a(this).find('option[value="normal"]').remove()});a("#X_Bd .span3 .X-Blog-Row").each(function(){a(this).attr("data-value")==
1?a(this).show():a(this).hide()});a("#X_Bd .span9 .X-Blog-Row").each(function(){a(this).attr("data-value")<3?a(this).show():a(this).hide()});a("input.xt-form-tabs-nav:checked",e).change();a("select.xt-form-tabs-nav",e).change();a("select.multiselect",e).each(function(){a(this).data("multiselect")||a(this).multiselect({searchable:false})})}function k(e){ADD_PARENT=e;e=ADD_PARENT.closest(".X_Grid");var b=e.attr("data-widgets"),c=ADD_PARENT.closest(".X_Region"),d=e.attr("data-value");a(".widget-list .widget",
a("#"+b)).each(function(){a(this).hide();if(d=="header"||d=="footer"||isNaN(d)&&d!="home")a(this).attr("data-page").indexOf(d)!=-1&&a(this).show();else if(a(this).attr("data-page").indexOf("custom")!=-1){var f=c.attr("data-value");a(this).attr("data-layout").indexOf(f.replace("span",""))!=-1&&a(this).show()}});tb_show("\u6dfb\u52a0\u53ef\u7528\u6a21\u5757","#TB_inline?height=450&width=850&inlineId="+b)}wpWidgets={init:function(){var e=a("div.X_Region");a("input.widget-control-save").live("click",
function(){wpWidgets.save(a(this).closest("div.widget"),0,1,0);return false});a("a.widget-control-remove").live("click",function(){wpWidgets.save(a(this).closest("div.widget"),1,1,0);return false});a("a.widget-control-close").live("click",function(){wpWidgets.close(a(this).closest("div.widget"));return false});e.children(".widget").each(function(){wpWidgets.appendTitle(this);a("p.widget-error",this).length&&a("a.widget-action",this).click()});a("#X_Hd,#X_Bd,#X_Ft").sortable({placeholder:"widget-placeholder",
items:".X_Layout",handle:".move",cursor:"move",distance:2,containment:"document",start:function(b,c){c.placeholder.css({height:c.item.css("height"),width:c.item.css("width")})},stop:function(b,c){wpWidgets.saveOrder(c.item.closest(".X_Grid"),false)},receive:function(){}});e.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"document",start:function(b,c){c.item.children(".widget-inside").hide();c.item.css({margin:"",
"z-index":""})},stop:function(b,c){c.item.hasClass("ui-draggable")&&c.item.data("draggable")&&c.item.draggable("destroy");if(c.item.hasClass("deleting")){wpWidgets.save(c.item,1,0,1);c.item.remove()}else{c.item.css({margin:"","z-index":""});wpWidgets.saveOrder(c.item.closest(".X_Grid"),false)}},receive:function(){}});a("#X_Page-Edit input.xt-form-tabs-nav").live("change",function(){var b=a(this).parents("form:first"),c=b.find(".xt-form-tabs-nav").index(this);a(this).parents(".widget:first");a(this).is(":checked")&&
b.find(".xt-form-tabs-tab").hide().eq(c).show()});a("#X_Page-Edit select.xt-form-tabs-nav").live("change",function(){var b=a(this).parents("form:first"),c=a(this).find("option").index(a(this).find("option:selected"));b.find(".xt-form-tabs-tab").hide().eq(c).show()});a("#X_Page-Edit .xt-itemcats").live("click",function(){var b=a(this).attr("data-type"),c=a(this).attr("data-limit"),d=a(this).attr("data-cids"),f=a(this).attr("data-cnames"),i=a(this).attr("id"),h=a(this).attr("data-field-cid"),l=a(this).attr("data-field-cname");
c||(c=1);try{a.ajax({type:"get",dataType:"html",url:ajaxurl,data:{action:"xt_admin_ajax_itemcats_editor",type:b},success:function(n){a("#X_Cat_Selector_Container").html(n);a("#X_Cat_Selector").xtTaobaoItemCats({f_a:i,f_cid:h,f_cname:l,cids:d,cnames:f,limit:c,type:b});tb_show("\u9009\u62e9\u5206\u7c7b","#TB_inline?height=355&width=765&inlineId=X_Cat_Selector_Container&model=true")},error:function(){alert("\u52a0\u8f7d\u5206\u7c7b\u51fa\u9519")}})}catch(m){alert(m)}return false});a("#X_Page-Edit .X_Region .widget-top").live({mouseenter:function(){a("#X_Page-Edit .X_Region .widget-title-action a").hide();
a(".widget-title-action a",this).show()},mouseleave:function(){a("#X_Page-Edit .X_Region .widget-title-action a").hide()}});a("#X_Page-Edit .X_Region .widget-control-cancel").live("click",function(){a(this).closest("div.widget").find(".widget-title-action a.act-edit").click()});a("#X_Page-Edit .X_Region .widget-title-action a.act-edit").live("click",function(){var b={},c=a(this).closest("div.widget"),d=c.children(".widget-inside"),f=parseInt(c.find("input.widget-width").val(),10);a(this).closest(".X_Layout");
var i="margin-left";if(a(this).closest(".X_Region").index()==0)i="margin-right";if(d.is(":hidden")){a("#X_Page-Edit .X_Region .widget-inside").each(function(){a(this).is(":hidden")||a(this).closest(".widget").find(".widget-title-action a.act-edit").click()});var h=parseInt(c.width());if(f>h){b.width=f+"px";b[i]=h-f+"px";b["z-index"]=10;c.css(b)}wpWidgets.fixLabels(c);d.slideDown("fast");j(c)}else d.slideUp("fast",function(){c.css({width:"",margin:"","z-index":""})});return false});a("#X_Page-Edit .X_Region .widget-title-action a.act-add").live("click",
function(){k(a(this).closest(".widget"));return false});a("#X_Page-Edit .X_Region .X_EmptyBox a.act-add").live("click",function(){k(a(this).closest(".X_EmptyBox"));return false});a(".widget-list .widget-title-action a.act-add").live("click",function(){if(ADD_PARENT){var b=a(this).closest(".widget").clone(),c=b.attr("id"),d=b.find("input.multi_number").val();ADD_PARENT.after(b.html(b.html().replace(/<[^<>]+>/g,function(f){return f.replace(/__i__|%i%/g,d)})));ADD_PARENT.hasClass("X_EmptyBox")&&ADD_PARENT.remove();
b.attr("id",c.replace("__i__",d));d++;a("div#"+c).find("input.multi_number").val(d);wpWidgets.save(b,0,0,1);b.find("input.add_new").val("");tb_remove();b.find("a.act-edit").click()}return false});a("#X_Bd .cl .del").live("click",function(){if(confirm("\u5220\u9664\u5e03\u5c40\u540e,\u8be5\u5e03\u5c40\u5185\u6240\u6709\u6a21\u5757\u5c06\u88ab\u5220\u9664,\u786e\u5b9a?")){var b=a(this).closest(".X_Grid");a(this).closest(".X_Layout").remove();wpWidgets.saveOrder(b,true)}return false});a("#X_Bd .cl .edit").live("click",
function(){CHANGE_LAYOUT=a(this).closest(".X_Layout");a("#X_Layout-Change-List a").removeClass("selected");a('#X_Layout-Change-List a[data-value="'+CHANGE_LAYOUT.attr("data-value")+'"]').addClass("selected");tb_show("\u5207\u6362\u5e03\u5c40","#TB_inline?height=80&width=600&inlineId=X_Widgets-Layout-Change-Box");return false});a("#X_AddLayout").click(function(){tb_show("\u6dfb\u52a0\u5e03\u5c40","#TB_inline?height=130&width=600&inlineId=X_Widgets-Layout-Box");return false});a("#X_Layout-Add-List a").click(function(){var b=
[],c=a(this).attr("data-value");b.push('<div class="row X_Layout" data-value="'+c+'">');c=c.split("-");for(var d=1;d<c.length;d++)b.push('<div class="span'+c[d]+' X_Region" data-value="span'+c[d]+'"><div class="X_EmptyBox emptyp X_Module"><span>\u8bf7\u6dfb\u52a0\u6a21\u5757</span><a class="act-add" href="#"></a></div></div>');b.push('<p class="cl"><a class="move" title="\u79fb\u52a8"></a><a class="edit" title="\u7f16\u8f91"></a><a class="del" title="\u5220\u9664"></a></p>');a("#X_AddLayout").closest(".row").before(b.join(""));
tb_remove();wpWidgets.saveOrder(a("#X_Bd"),false)});a("#X_Layout-Change-List a").click(function(){var b=a(this).attr("data-value");if(CHANGE_LAYOUT.attr("data-value")==b){tb_remove();return false}CHANGE_LAYOUT.prepend(CHANGE_LAYOUT.find(".X_Region:last"));CHANGE_LAYOUT.attr("data-value",b);wpWidgets.saveOrder(a("#X_Bd"),false);tb_remove();return false});a("#X_Widgets-Text-Editor .button-primary").click(function(){if(EDITOR){var b=EDITOR.getContent();if(b)b=b.replace(/<p><br\s*?\/><\/p>/gi,"");EDITOR.xt.isWidget?
TEXTAREA.closest(".widget").find(".xt-iswidget").attr("checked",true):TEXTAREA.closest(".widget").find(".xt-iswidget").attr("checked",false);TEXTAREA.val(b)}tb_remove()});a("#X_Page-Edit .X_Region .act-editor").live("click",function(){var b=a(this).closest(".widget").find("textarea");TEXTAREA=b;var c=a(this).closest(".X_Region").attr("data-value"),d="100%";switch(c){case "span3":d="235px";break;case "span9":d="745px";break;case "span12":d="1000px";break}UEDITOR_CONFIG.iframeCssUrl=XT_IFRAME.theme;
UEDITOR_CONFIG.initialStyle="html{overflow-y:hidden;}body{margin:0px;font-family: tahoma, arial, \u0005b8b\u0004f53;font-size: 13px;line-height: 19px;color: #333;width:"+d+"}.unstyled li,.xt-custom-fandongxi li{clear:none;}"+XT_IFRAME.style;tb_show("\u7f16\u8f91\u5668","#TB_inline?height=450&width=1010&inlineId=X_Widgets-Text-Editor-Box");if(EDITOR!=null){EDITOR.destroy();EDITOR=null}if(EDITOR==null){EDITOR=new baidu.editor.ui.Editor;EDITOR.xt={region:c,isWidget:true};EDITOR.render("X_Editor");EDITOR.ready(function(){EDITOR.reset();
var f=b.val();f?EDITOR.setContent(f):EDITOR.setContent("")});EDITOR.addListener("fullScreenChanged",function(f,i){i&&a("#edui1").css("top","28px")})}return false})},saveOrder:function(e,b){var c={action:"xt_admin_ajax_widgets_order",savewidgets:a("#_wpnonce_home_widgets").val(),page:e.attr("data-value"),layout:[],sid:SID};if(b)c.refresh=1;var d=[];a("div.X_Layout",e).each(function(){var f={name:a(this).attr("data-value"),"delete":a(this).find(".cl .del").length==1?1:0,layout:{}};a("div.X_Region",
a(this)).each(function(){var i="";if(a("div.widget",a(this)).length>0){i={};a("div.widget",a(this)).each(function(){var h={edit:1,"delete":1};h.edit=a(this).find("a.act-edit").length==1?1:0;h["delete"]=a(this).find(".widget-control-remove").length==1?1:0;i[a(this).attr("id").split("_")[1]]=h})}if(a(this).attr("data-value"))f.layout[a(this).attr("data-value")]=i});d.push(f)});if(d.length==0)d="";c.layout=d;a.post(ajaxurl,c,function(){a("img.ajax-feedback").css("visibility","hidden")});this.resize()},
save:function(e,b,c,d){var f=e.closest("div.X_Grid"),i=e.find("form").serialize(),h;e=a(e);a(".ajax-feedback",e).css("visibility","visible");h={action:"xt_admin_ajax_widgets_save",savewidgets:a("#_wpnonce_home_widgets").val(),page:f.attr("data-value"),sid:SID};if(b)h.delete_widget=1;i+="&"+a.param(h);a.post(ajaxurl,i,function(l){var m;if(b){if(!a("input.widget_number",e).val()){m=a("input.widget-id",e).val();a("#available-widgets").find("input.widget-id").each(function(){a(this).val()==m&&a(this).closest("div.widget").show()})}if(c){d=
0;e.slideUp("fast",function(){a(this).parent().children().length==1?a(this).replaceWith('<div class="X_EmptyBox emptyp X_Module" data-ismove="0"><span>\u8bf7\u6dfb\u52a0\u6a21\u5757</span><a class="act-add" href="#"></a></div>'):a(this).remove();wpWidgets.saveOrder(f,false)})}else{e.parent().children().length==1?e.replaceWith('<div class="X_EmptyBox emptyp X_Module" data-ismove="0"><span>\u8bf7\u6dfb\u52a0\u6a21\u5757</span><a class="act-add" href="#"></a></div>'):e.remove();wpWidgets.resize()}}else{a(".ajax-feedback").css("visibility",
"hidden");if(l&&l.length>2){a("div.widget-content",e).html(l);j(e);wpWidgets.appendTitle(e);wpWidgets.fixLabels(e)}}d&&wpWidgets.saveOrder(f,false)})},appendTitle:function(e){var b=a('input[id*="-title"]',e).val()||"";if(b)b=": "+b.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;");a(e).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(b)},resize:function(){a("div.widgets-sortables").each(function(){if(a(this).parent().hasClass("inactive"))return true;
var e=50,b=a(this).children(".widget").length;e+=parseInt(b*48,10);a(this).css("minHeight",e+"px")})},fixLabels:function(e){e.children(".widget-inside").find("label").each(function(){var b=a(this).attr("for");b&&b==a("input",this).attr("id")&&a(this).removeAttr("for")})},close:function(e){e.children(".widget-inside").slideUp("fast",function(){e.css({width:"",margin:""})})}};a(document).ready(function(e){var b=e("#X_Bd-Container");g(b.attr("data-id"),b.attr("data-name"),function(c){e("#X_Bd-Container").html(c);
wpWidgets.init()})})})(jQuery);